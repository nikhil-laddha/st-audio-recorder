(this.webpackJsonpstreamlit_component_template=this.webpackJsonpstreamlit_component_template||[]).push([[0],{10:function(t,e,s){t.exports=s(20)},20:function(t,e,s){"use strict";s.r(e);var r=s(1),i=s.n(r),n=s(6),a=s.n(n),o=s(2),h=s(9),l=s(7),c=s(4),u=s(3);s(19);o.b.add(h.a);class p extends c.b{constructor(t){super(t),this.stream=null,this.AudioContext=window.AudioContext||window.webkitAudioContext,this.type="audio/wav",this.sampleRate=null,this.phrase_buffer_count=null,this.pause_buffer_count=null,this.pause_count=0,this.stage=null,this.volume=null,this.audioInput=null,this.analyser=null,this.recorder=null,this.recording=!1,this.leftchannel=[],this.rightchannel=[],this.leftBuffer=null,this.rightBuffer=null,this.recordingLength=0,this.tested=!1,this.getStream=()=>navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),this.setupMic=async()=>{try{window.stream=this.stream=await this.getStream()}catch(t){console.log("Error: Issue getting mic",t)}this.startRecording()},this.closeMic=()=>{this.stream.getAudioTracks().forEach(t=>{t.stop()}),this.audioInput.disconnect(0),this.analyser.disconnect(0),this.recorder.disconnect(0)},this.writeUTFBytes=(t,e,s)=>{let r=s.length;for(let i=0;i<r;i++)t.setUint8(e+i,s.charCodeAt(i))},this.mergeBuffers=(t,e)=>{let s=new Float32Array(e),r=0,i=t.length;for(let n=0;n<i;n++){let e=t[n];s.set(e,r),r+=e.length}return s},this.interleave=(t,e)=>{let s=t.length+e.length,r=new Float32Array(s),i=0;for(let n=0;n<s;)r[n++]=t[i],r[n++]=e[i],i++;return r},this.startRecording=()=>{let t=this.props.args.sample_rate;null===t?(this.context=new this.AudioContext,this.sampleRate=this.context.sampleRate):(this.context=new this.AudioContext({sampleRate:t}),this.sampleRate=t),console.log("Sample rate ".concat(this.sampleRate,"Hz"));let e=2048/this.sampleRate;this.pause_buffer_count=Math.ceil(this.props.args.pause_threshold/e),this.pause_count=0,this.stage="start",this.volume=this.context.createGain(),this.audioInput=this.context.createMediaStreamSource(this.stream),this.analyser=this.context.createAnalyser(),this.audioInput.connect(this.analyser),this.recorder=this.context.createScriptProcessor(2048,2,2),this.analyser.connect(this.recorder),this.recorder.connect(this.context.destination);const s=this;this.recorder.onaudioprocess=function(t){if(!s.recording)return;let e=t.inputBuffer.getChannelData(0),r=t.inputBuffer.getChannelData(1);s.tested||(s.tested=!0,e.reduce((t,e)=>t+e)||(console.log("Error: There seems to be an issue with your Mic"),s.stop(),s.stream.getTracks().forEach((function(t){t.stop()})),s.context.close()));let i=Math.sqrt(e.map(t=>t*t).reduce((t,e)=>t+e)/e.length);"start"===s.stage&&i>s.props.args.start_threshold?s.stage="speaking":"speaking"===s.stage&&(i>s.props.args.end_threshold?s.pause_count=0:(s.pause_count+=1,s.pause_count>s.pause_buffer_count&&s.stop())),s.leftchannel.push(new Float32Array(e)),s.rightchannel.push(new Float32Array(r)),s.recordingLength+=2048}},this.start=async()=>{this.recording=!0,this.setState({color:this.props.args.recording_color,recordState:u.a.START}),await this.setupMic(),this.leftchannel.length=this.rightchannel.length=0,this.recordingLength=0},this.stop=async()=>{this.recording=!1,this.setState({color:this.props.args.neutral_color,recordState:u.a.STOP}),this.closeMic(),console.log(this.recordingLength),this.leftBuffer=this.mergeBuffers(this.leftchannel,this.recordingLength),this.rightBuffer=this.mergeBuffers(this.rightchannel,this.recordingLength);let t=this.interleave(this.leftBuffer,this.rightBuffer),e=new ArrayBuffer(44+2*t.length),s=new DataView(e);this.writeUTFBytes(s,0,"RIFF"),s.setUint32(4,44+2*t.length,!0),this.writeUTFBytes(s,8,"WAVE"),this.writeUTFBytes(s,12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,2,!0),s.setUint32(24,this.sampleRate,!0),s.setUint32(28,4*this.sampleRate,!0),s.setUint16(32,4,!0),s.setUint16(34,16,!0),this.writeUTFBytes(s,36,"data"),s.setUint32(40,2*t.length,!0);let r=t.length,i=44;for(let o=0;o<r;o++)s.setInt16(i,32767*t[o],!0),i+=2;const n=new Blob([s],{type:this.type}),a=URL.createObjectURL(n);await this.onStop({blob:n,url:a,type:this.type}),this.leftchannel.length=this.rightchannel.length=0,this.recordingLength=0},this.render=()=>{const{theme:t}=this.props,e=this.props.args.text;return i.a.createElement("div",null,i.a.createElement("span",null,e," \xa0",i.a.createElement(l.a,{icon:this.props.args.icon_name,onClick:this.onClicked,style:{color:this.state.color},size:this.props.args.icon_size})),i.a.createElement(u.b,{state:this.state.recordState,backgroundColor:"rgb(255, 255, 255)",foregroundColor:"rgb(255,76,75)",canvasWidth:300,canvasHeight:100,onStop:this.onStop}))},this.onClicked=async()=>{this.recording?await this.stop():await this.start()},this.onStop=async t=>{var e=await t.blob.arrayBuffer(),s=JSON.stringify(Array.from(new Uint8Array(e)));c.a.setComponentValue(s)},this.state={color:this.props.args.neutral_color,recordState:u.a.STOP}}}var g=Object(c.c)(p);a.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(g,null)),document.getElementById("root"))}},[[10,1,2]]]);
//# sourceMappingURL=main.cf268bf5.chunk.js.map